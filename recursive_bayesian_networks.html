<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recursive Bayesian Networks &mdash; rbnet  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="_static/autoclasstoc.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Gallery and Examples" href="auto_examples/index.html" />
    <link rel="prev" title="Recursive Bayesian Networks" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            rbnet
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Recursive Bayesian Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#inside-probabilities">Inside Probabilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simple-binary-case">Simple Binary Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general-inside-probabilities">General Inside Probabilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#marginal-likelihood">Marginal Likelihood</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parsing">Parsing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="auto_examples/index.html">Gallery and Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_summary.html">API Summary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">rbnet</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Recursive Bayesian Networks</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="recursive-bayesian-networks">
<h1>Recursive Bayesian Networks<a class="headerlink" href="#recursive-bayesian-networks" title="Link to this heading"></a></h1>
<section id="inside-probabilities">
<h2>Inside Probabilities<a class="headerlink" href="#inside-probabilities" title="Link to this heading"></a></h2>
<p>The inside probability</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<div class="math">
<p><span class="math">\beta(x_{i:k}) = p(\mathbf{Y}_{i:k} \ |\ x_{i:k})</span></p>
</div></div>
<p>is the probability of generating the subsequence of terminal variables
<span class="math">\mathbf{Y}_{i:k}=\{y_{i+1},\ldots,y_{k}\}</span>
from the non-terminal variable
<span class="math">x_{i:k}</span>
with all intermediate variables marginalised out.</p>
<section id="simple-binary-case">
<h3>Simple Binary Case<a class="headerlink" href="#simple-binary-case" title="Link to this heading"></a></h3>
<p>This can be best understood by looking at a simple example with a single non-terminal template variable and a binary split transition:</p>
<img alt="Tree diagram" src="_images/tree.svg" /><p>The inside probability <span class="math">\beta(x_{1:9})</span> is the probability of generating the subsequence of terminal variables
<span class="math">\mathbf{Y}_{1:9}=\{y_{2},\ldots,y_{9}\}</span>
from the non-terminal variable
<span class="math">x_{1:9}</span>.
Its value can be computed recursively by looking one step ahead in the generating process and considering all possibilities.
In this simple case, the next step will always produce two child variables and the different possibilities are simply which part
of the sequence is generated by which of the children. This includes the three possibilities illustrated above:</p>
<blockquote>
<div><ul class="simple">
<li><p>…</p></li>
<li><p>orange [split at <span class="math">j=4</span>]: the left child <span class="math">x_{1:4}</span> generates <span class="math">\{y_2,\ldots,y_4\}</span>; the right child <span class="math">x_{4:9}</span> generates <span class="math">\{y_5,\ldots,y_9\}</span></p></li>
<li><p>blue [split at <span class="math">j=5</span>]: the left child <span class="math">x_{1:5}</span> generates <span class="math">\{y_2,\ldots,y_5\}</span>; the right child <span class="math">x_{5:9}</span> generates <span class="math">\{y_6,\ldots,y_9\}</span></p></li>
<li><p>green [split at <span class="math">j=6</span>]: the left child <span class="math">x_{1:6}</span> generates <span class="math">\{y_2,\ldots,y_6\}</span>; the right child <span class="math">x_{6:9}</span> generates <span class="math">\{y_7,\ldots,y_9\}</span>.</p></li>
<li><p>…</p></li>
</ul>
</div></blockquote>
<p>but splitting points <span class="math">j</span> can go from 2 up to 8 (<span class="math">i&lt;j&lt;k</span>). These different possibilities have to be summed up and the intermediate variables (the left and right child) have to be marginalised out:</p>
<div class="math">
<p><span class="math">\beta(x_{i:k})
={}&amp;
p_S(z_{i:k}=\tau \mid x_{i:k})
\sum_{i&lt;j&lt;k}
\int\int
p_{\tau}(x_{i:j}, x_{j:k} \mid x_{i:k}) \
\beta(x_{i:j}) \beta(x_{j:k}) \
dx_{i:j} dx_{j:k}</span></p>
</div><p>Here, the sum runs over all possible splitting points and the integrals marginalise out the intermediate (child) variables.
The inside probabilities <span class="math">\beta(x_{i:j})</span> and <span class="math">\beta(x_{j:k})</span> are the recursive part and “hide” all subsequent generation steps from the children on.
Finally, the particular binary transition that we considered here (denoted by <span class="math">\tau</span>) is usually only one of multiple possible transitions (at least one other transition is needed to generate terminal variables).
We therefore have to multiply everything by the probability of taking this particular transition, which is the first term with the structural distribution <span class="math">p_S</span>.</p>
</section>
<section id="general-inside-probabilities">
<span id="id1"></span><h3>General Inside Probabilities<a class="headerlink" href="#general-inside-probabilities" title="Link to this heading"></a></h3>
<p>If the simple binary case is clear, it is much easier to understand the more complex general case, which differs in the following.</p>
<p><strong>Multiple template variables:</strong> So far, we had a single non-terminal template variable <span class="math">x</span> that could be instantiated at any possible location <span class="math">i:k</span> in the parse chart (<span class="math">x_{i:k}</span>). In other words, the set of non-terminal template variables <span class="math">\mathcal{X}</span> contained a single variable <span class="math">\mathcal{X}=\{x\}</span>. However, in general, <span class="math">\mathcal{X}</span> may contain an arbitrary number of non-terminal template variables <span class="math">\mathcal{X}=\{x^{(1)},x^{(2)},\ldots\}</span>. The same is true for the set of terminal template variables <span class="math">\mathcal{Y}=\{y^{(1)},y^{(2)},\ldots\}</span>.</p>
<p><strong>Multiple possible transitions:</strong> As mentioned above, even in the simple binary case, there has to be at least one other transition to generate the terminal variables (as the binary split only generates two new non-terminal variables). In general, there may be an arbitrary number of transitions <span class="math">\tau\in\mathcal{T}_x</span> from a particular non-terminal variable <span class="math">x</span> and each transition may involve any number of terminal or non-terminal variables <span class="math">v\in\mathcal{X}\cup\mathcal{Y}</span>.</p>
<p><strong>Multiple splitting points:</strong> If a transition generates more than two variables, there is more than one splitting point. To be precise, if a transition generates <span class="math">\eta</span> variables, there are <span class="math">\eta-1</span> splitting points, which we can denote by <span class="math">j_1,\ldots,j_{\eta-1}</span>.</p>
<p>Taking this into account, the general form of the inside probabilities for the non-terminal variable <span class="math">x_{i:k}</span> is given by</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<div class="math">
<p><span class="math">\beta(x_{i:k})
={}&amp;
\sum_{\tau \in \mathcal{T}_x}
p_S(z_{i:k}=\tau \mid x_{i:k})
{\sum\cdots\sum}_{i&lt;j_1&lt;\ldots&lt;j_{\eta-1}&lt;k} \\
&amp; {\int\cdots\int}_{\{v_{j:j^\prime}\in\mathcal{X}\}}
p_{\tau}(v_{i:j_1}, \ldots, v_{j_{\eta-1}:k} \mid x_{i:k})
\prod_{\{v_{j:j^\prime}\in\mathcal{X}\}}
\beta(v_{j:j^\prime}).</span></p>
</div></div>
<p>We denote the second line as <em>inside marginals</em> <span class="math">\widetilde{\beta}_{i:\ldots:k}(x_{i:k})</span></p>
<div class="math">
<p><span class="math">\widetilde{\beta}_{i:\ldots:k}(x_{i:k})
=
{\int\cdots\int}_{\{v_{j:j^\prime}\in\mathcal{X}\}}
p_{\tau}(v_{i:j_1}, \ldots, v_{j_{\eta-1}:k} \mid x_{i:k})
\prod_{\{v_{j:j^\prime}\in\mathcal{X}\}}
\beta(v_{j:j^\prime}),</span></p>
</div><p>where the subscript <span class="math">i:\ldots:k</span> indicates the dependency on <span class="math">i&lt;j_1&lt;\ldots&lt;j_{\eta-1}&lt;k</span>.
This is implemented in <code class="xref py py-meth docutils literal notranslate"><span class="pre">Transition.inside_marginals()</span></code>, which returns
an array or iterable over all possible inside marginals <span class="math">\widetilde{\beta}_{i:\ldots:k}(x_{i:k})</span> for the
different (combinations of) splitting points.</p>
<p>We denote the summation in the first line as <em>inside mixture</em>. It uses the inside marginals
<span class="math">\widetilde{\beta}_{i:\ldots:k}(x_{i:k})</span> to compute the (multi-)sum over possible (combinations of) splitting
points as well as the sum over possible transitions weighted by the structural distribution.</p>
<div class="math">
<p><span class="math">\beta(x_{i:k})
=
\sum_{\tau \in \mathcal{T}_x}
p_S(z_{i:k}=\tau \mid x_{i:k})
{\sum\cdots\sum}_{i&lt;j_1&lt;\ldots&lt;j_{\eta-1}&lt;k} \ \widetilde{\beta}_{i:\ldots:k}(x_{i:k})</span></p>
</div><p>This is implemented in <code class="xref py py-meth docutils literal notranslate"><span class="pre">Cell.inside_mixture()</span></code>.</p>
<p>To explain the different parts of the equation in more detail, we have:</p>
<ul class="simple">
<li><p>The sum over all possible transitions for the given variable, weighting each transition by its probability to
occur, given by the structural distribution:</p></li>
</ul>
<div class="math">
<p><span class="math">\sum_{\tau \in \mathcal{T}_x}
p_S(z_{i:k}=\tau \mid x_{i:k})</span></p>
</div><ul class="simple">
<li><p>The multi-sum over all possible combinations of splitting points. For the simple binary case, where we only have a
single splitting point, this reduces to the simple sum from above. A larger number of splitting points quickly
becomes computationally expensive as the number of possibilities grows exponentially (and is also more difficult to
vectorise):</p></li>
</ul>
<div class="math">
<p><span class="math">{\sum\cdots\sum}_{i&lt;j_1&lt;\ldots&lt;j_{\eta-1}&lt;k}</span></p>
</div><ul class="simple">
<li><p>The multi-integral to marginalise out the set of generated non-terminal (child) variables (denoted by
<span class="math">\{v_{j:j^\prime}\in\mathcal{X}\}</span>). Importantly, this does not include any terminal variables that may have been
generated along with the non-terminal variables:</p></li>
</ul>
<div class="math">
<p><span class="math">&amp; {\int\cdots\int}_{\{v_{j:j^\prime}\in\mathcal{X}\}}</span></p>
</div><ul class="simple">
<li><p>The actual transition probability. The generated variables <span class="math">v_{i:j_1}, \ldots, v_{j_{\eta-1}:k}</span> may contain
both non-terminal variables and terminal variables:</p></li>
</ul>
<div class="math">
<p><span class="math">p_{\tau}(v_{i:j_1}, \ldots, v_{j_{\eta-1}:k} \mid x_{i:k})</span></p>
</div><ul class="simple">
<li><p>The recursive part containing the product of inside probabilities of all generated non-terminal variables.</p></li>
</ul>
<div class="math">
<p><span class="math">\prod_{\{v_{j:j^\prime}\in\mathcal{X}\}}
\beta(v_{j:j^\prime}).</span></p>
</div></section>
</section>
<section id="marginal-likelihood">
<span id="id2"></span><h2>Marginal Likelihood<a class="headerlink" href="#marginal-likelihood" title="Link to this heading"></a></h2>
<p>The marginal likelihood <span class="math">p(\mathbf{Y})</span> is the probability of the observed data after marginalising out all latent variables of the model. This is the quantity typically used to measure how well a model describes the data and model parameters are optimised to minimise the marginal negative log likelihood <span class="math">- \log p(\mathbf{Y})</span>. We obtain the marginal likelihood from the inside probabilities at the root node</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<div class="math">
<p><span class="math">p(\mathbf{Y}) = \sum_{x\in\mathcal{X}} w_x \int \beta(x_{0:n}) \ p_P(x_{0:n}) \ dx_{0:n},</span></p>
</div></div>
<p>where <span class="math">p_P(x_{0:n})</span> is the prior transition that generates a non-terminal variable of type <span class="math">x</span> from scratch and
<span class="math">w_x</span> is the probability of generating a particular template variable of type <span class="math">x</span>. Note that this is fundamentally
the same as for normal transitions (<span class="math">w_x</span> is the equivalent of the structural distribution), except that some
things simplify as we do not condition on another non-terminal variable and do not have to consider possible splitting points
as we are generating only a single new non-terminal variable. Computing marginal likelihoods from the inside probabilities
at the root node is implemented in <code class="xref py py-meth docutils literal notranslate"><span class="pre">Prior.marginal_likelihood()</span></code>,
which essentially corresponds to combining the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Transition.inside_marginals()</span></code>
and <code class="xref py py-meth docutils literal notranslate"><span class="pre">Cell.inside_mixture()</span></code> methods for the special case of the prior.</p>
</section>
<section id="parsing">
<h2>Parsing<a class="headerlink" href="#parsing" title="Link to this heading"></a></h2>
<p>To compute marginal likelihoods, we have to recursively evaluate the equation for general inside probabilities
to obtain their values at the root node. This is done by the <code class="xref py py-meth docutils literal notranslate"><span class="pre">RBN.inside()</span></code> method.
It iterates over all inside variables using <code class="xref py py-meth docutils literal notranslate"><span class="pre">inside_schedule()</span></code>,
delegating the marginalisation of variables to <code class="xref py py-meth docutils literal notranslate"><span class="pre">Transition.inside_marginals()</span></code>
and computing mixtures to <code class="xref py py-meth docutils literal notranslate"><span class="pre">Cell.inside_mixture()</span></code>, before returning the
marginal likelihood computed via <code class="xref py py-meth docutils literal notranslate"><span class="pre">Prior.marginal_likelihood()</span></code>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Recursive Bayesian Networks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="auto_examples/index.html" class="btn btn-neutral float-right" title="Gallery and Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Robert Lieck.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>